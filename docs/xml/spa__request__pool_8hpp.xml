<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="spa__request__pool_8hpp" kind="file" language="C++">
    <compoundname>spa_request_pool.hpp</compoundname>
    <includes refid="spa__pipeline_8hpp" local="yes">spa_pipeline.hpp</includes>
    <includes refid="dbapp__extensions_2wgbilling__spa_2types_8hpp" local="yes">types.hpp</includes>
    <includes local="yes">cstdmf/bw_string.hpp</includes>
    <includes local="yes">cstdmf/bw_vector.hpp</includes>
    <includes local="yes">math/ema.hpp</includes>
    <includes local="no">deque</includes>
    <includedby refid="spa__billing__system_8hpp" local="yes">dbapp_extensions/wgbilling_spa/spa_billing_system.hpp</includedby>
    <includedby refid="spa__pipeline_8hpp" local="yes">dbapp_extensions/wgbilling_spa/spa_pipeline.hpp</includedby>
    <includedby refid="spa__request_8hpp" local="yes">dbapp_extensions/wgbilling_spa/spa_request.hpp</includedby>
    <includedby refid="spa__request__pool_8cpp" local="yes">dbapp_extensions/wgbilling_spa/spa_request_pool.cpp</includedby>
    <incdepgraph>
      <node id="15614">
        <label>types.hpp</label>
        <link refid="dbapp__extensions_2wgbilling__spa_2types_8hpp_source"/>
        <childnode refid="15615" relation="include">
        </childnode>
        <childnode refid="15613" relation="include">
        </childnode>
        <childnode refid="15607" relation="include">
        </childnode>
        <childnode refid="15616" relation="include">
        </childnode>
        <childnode refid="15618" relation="include">
        </childnode>
      </node>
      <node id="15599">
        <label>http_pipeline.hpp</label>
        <link refid="http__pipeline_8hpp_source"/>
        <childnode refid="15600" relation="include">
        </childnode>
        <childnode refid="15611" relation="include">
        </childnode>
        <childnode refid="15601" relation="include">
        </childnode>
        <childnode refid="15614" relation="include">
        </childnode>
        <childnode refid="15612" relation="include">
        </childnode>
        <childnode refid="15605" relation="include">
        </childnode>
      </node>
      <node id="15602">
        <label>network/misc.hpp</label>
      </node>
      <node id="15597">
        <label>dbapp_extensions/wgbilling_spa/spa_request_pool.hpp</label>
        <link refid="spa_request_pool.hpp"/>
        <childnode refid="15598" relation="include">
        </childnode>
        <childnode refid="15614" relation="include">
        </childnode>
        <childnode refid="15607" relation="include">
        </childnode>
        <childnode refid="15616" relation="include">
        </childnode>
        <childnode refid="15619" relation="include">
        </childnode>
        <childnode refid="15620" relation="include">
        </childnode>
      </node>
      <node id="15604">
        <label>network/endpoint.hpp</label>
      </node>
      <node id="15611">
        <label>http_request.hpp</label>
        <link refid="http__request_8hpp_source"/>
        <childnode refid="15612" relation="include">
        </childnode>
        <childnode refid="15613" relation="include">
        </childnode>
        <childnode refid="15607" relation="include">
        </childnode>
      </node>
      <node id="15607">
        <label>cstdmf/bw_string.hpp</label>
      </node>
      <node id="15609">
        <label>cstdmf/bgtask_manager.hpp</label>
      </node>
      <node id="15601">
        <label>tcp_connection.hpp</label>
        <link refid="tcp__connection_8hpp_source"/>
        <childnode refid="15602" relation="include">
        </childnode>
        <childnode refid="15603" relation="include">
        </childnode>
        <childnode refid="15604" relation="include">
        </childnode>
        <childnode refid="15605" relation="include">
        </childnode>
        <childnode refid="15606" relation="include">
        </childnode>
        <childnode refid="15607" relation="include">
        </childnode>
        <childnode refid="15600" relation="include">
        </childnode>
      </node>
      <node id="15613">
        <label>cstdmf/bw_map.hpp</label>
      </node>
      <node id="15610">
        <label>cstdmf/bw_set.hpp</label>
      </node>
      <node id="15608">
        <label>network/frequent_tasks.hpp</label>
      </node>
      <node id="15598">
        <label>spa_pipeline.hpp</label>
        <link refid="spa__pipeline_8hpp_source"/>
        <childnode refid="15599" relation="include">
        </childnode>
        <childnode refid="15597" relation="include">
        </childnode>
        <childnode refid="15614" relation="include">
        </childnode>
      </node>
      <node id="15619">
        <label>math/ema.hpp</label>
      </node>
      <node id="15603">
        <label>network/interfaces.hpp</label>
      </node>
      <node id="15620">
        <label>deque</label>
      </node>
      <node id="15612">
        <label>cstdmf/bw_namespace.hpp</label>
      </node>
      <node id="15600">
        <label>dns_resolver.hpp</label>
        <link refid="dns__resolver_8hpp_source"/>
        <childnode refid="15601" relation="include">
        </childnode>
        <childnode refid="15605" relation="include">
        </childnode>
        <childnode refid="15608" relation="include">
        </childnode>
        <childnode refid="15609" relation="include">
        </childnode>
        <childnode refid="15607" relation="include">
        </childnode>
        <childnode refid="15610" relation="include">
        </childnode>
      </node>
      <node id="15616">
        <label>cstdmf/bw_vector.hpp</label>
      </node>
      <node id="15617">
        <label>JSONValue.h</label>
        <link refid="_j_s_o_n_value_8h_source"/>
        <childnode refid="15607" relation="include">
        </childnode>
        <childnode refid="15615" relation="include">
        </childnode>
      </node>
      <node id="15615">
        <label>JSON.h</label>
        <link refid="_j_s_o_n_8h_source"/>
        <childnode refid="15616" relation="include">
        </childnode>
        <childnode refid="15607" relation="include">
        </childnode>
        <childnode refid="15613" relation="include">
        </childnode>
        <childnode refid="15617" relation="include">
        </childnode>
      </node>
      <node id="15605">
        <label>network/event_dispatcher.hpp</label>
      </node>
      <node id="15606">
        <label>cstdmf/timer_handler.hpp</label>
      </node>
      <node id="15618">
        <label>memory</label>
      </node>
    </incdepgraph>
    <invincdepgraph>
      <node id="15621">
        <label>dbapp_extensions/wgbilling_spa/spa_request_pool.hpp</label>
        <link refid="spa_request_pool.hpp"/>
        <childnode refid="15622" relation="include">
        </childnode>
        <childnode refid="15623" relation="include">
        </childnode>
        <childnode refid="15624" relation="include">
        </childnode>
      </node>
      <node id="15624">
        <label>dbapp_extensions/wgbilling_spa/spa_request.hpp</label>
        <link refid="spa__request_8hpp_source"/>
        <childnode refid="15625" relation="include">
        </childnode>
      </node>
      <node id="15622">
        <label>dbapp_extensions/wgbilling_spa/spa_billing_system.hpp</label>
        <link refid="spa__billing__system_8hpp_source"/>
      </node>
      <node id="15623">
        <label>dbapp_extensions/wgbilling_spa/spa_pipeline.hpp</label>
        <link refid="spa__pipeline_8hpp_source"/>
        <childnode refid="15621" relation="include">
        </childnode>
      </node>
      <node id="15625">
        <label>dbapp_extensions/wgbilling_spa/spa_login_request.hpp</label>
        <link refid="spa__login__request_8hpp_source"/>
      </node>
    </invincdepgraph>
    <innerclass refid="class_spa_request_pool" prot="public">SpaRequestPool</innerclass>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#ifndef<sp/>SPA_REQUEST_POOL_HPP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SPA_REQUEST_POOL_HPP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;spa_pipeline.hpp&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;types.hpp&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;cstdmf/bw_string.hpp&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;cstdmf/bw_vector.hpp&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;math/ema.hpp&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;deque&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"><ref refid="namespace_b_w___b_e_g_i_n___n_a_m_e_s_p_a_c_e" kindref="compound">BW_BEGIN_NAMESPACE</ref></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_spa_request" kindref="compound">SpaRequest</ref>;</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_spa_pipeline" kindref="compound">SpaPipeline</ref>;</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="25" refid="class_spa_request_pool" refkind="compound"><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_spa_request_pool" kindref="compound">SpaRequestPool</ref></highlight></codeline>
<codeline lineno="26"><highlight class="normal">{</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">friend</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_spa_pipeline" kindref="compound">SpaPipeline</ref>;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_spa_request_pool_1abc30be5f6d37dd7c6b2c54b3022c0f03" kindref="member">SpaRequestPool</ref>(<sp/>Mercury::EventDispatcher<sp/>&amp;<sp/>dispatcher,</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>BW::string<sp/>&amp;<sp/>poolName,</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>BW::string<sp/>&amp;<sp/>host,</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16<sp/><ref refid="class_spa_request_pool_1ac5b1cca5bb2c67df97623fd7b54b3cb5" kindref="member">port</ref>,</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1ab9ad891d472e1cffe5ea5e0a76dc77f2" kindref="member">pipelineCount</ref>,</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a792eb0718303d766e5eadea5ce5c8d21" kindref="member">batchSize</ref>,</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>queueSize,</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>connectionTimeout,</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a7923a764eba482a304e40e3d80328f69" kindref="member">requestTimeout</ref><sp/>);</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_spa_request_pool_1a198390bd71e765ee8464c4d32781542e" kindref="member">~SpaRequestPool</ref>();</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1ae4713ce3b17c121662baa68337b4d1d3" kindref="member">forceReconnect</ref>();</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1acbc2c7efb1c050344d207af2e85c9640" kindref="member">addRequest</ref>(<sp/><ref refid="class_spa_request" kindref="compound">SpaRequest</ref><sp/>*<sp/>pRequest<sp/>);</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a4f8e76c9a3fae743a95b6cf0bf2b3e57" kindref="member">updateStats</ref>(<sp/>uint64<sp/>totalTime,<sp/>uint64<sp/>spaRequestTime,<sp/>uint32<sp/>retryCount<sp/>);</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16<sp/><ref refid="class_spa_request_pool_1ac5b1cca5bb2c67df97623fd7b54b3cb5" kindref="member">port</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1ac5b1cca5bb2c67df97623fd7b54b3cb5" kindref="member">port</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16<sp/>port<sp/>);</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/>BW::string<sp/>host()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>host(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>BW::string<sp/>hostname<sp/>);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a745bffda84ee132d02c970c6a542d9f3" kindref="member">queuedCount</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a70ece3522f1b5805a6d5c2075c6b3988" kindref="member">isEnabled</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a70ece3522f1b5805a6d5c2075c6b3988" kindref="member">isEnabled</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>isEnabled<sp/>);</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32<sp/><ref refid="class_spa_request_pool_1a792eb0718303d766e5eadea5ce5c8d21" kindref="member">batchSize</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a792eb0718303d766e5eadea5ce5c8d21" kindref="member">batchSize</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32<sp/>batchSize<sp/>);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32<sp/><ref refid="class_spa_request_pool_1a6d41cf7130a8457437070a2a8e0badac" kindref="member">maxQueueSize</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a6d41cf7130a8457437070a2a8e0badac" kindref="member">maxQueueSize</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32<sp/>queueSize<sp/>);</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32<sp/><ref refid="class_spa_request_pool_1ab9ad891d472e1cffe5ea5e0a76dc77f2" kindref="member">pipelineCount</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1ab9ad891d472e1cffe5ea5e0a76dc77f2" kindref="member">pipelineCount</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32<sp/>pipelineCount<sp/>);</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64<sp/><ref refid="class_spa_request_pool_1a7923a764eba482a304e40e3d80328f69" kindref="member">requestTimeout</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a7923a764eba482a304e40e3d80328f69" kindref="member">requestTimeout</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint64<sp/>requestTimeout<sp/>);</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1ae573bf1791afafd59d992c60440dea90" kindref="member">avgTotalTime</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a542412113593db43473dafc4385e8dec" kindref="member">avgTimeInQueue</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a85a160675e74e62dcb3140e883368bb2" kindref="member">avgSpaRequestTime</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="class_spa_request_pool_1a9a135c74e547adef8635be94497af5aa" kindref="member">avgRetryCount</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="keyword">private</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>cleanup();</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>managePipelines();</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>markActivePipelinesAsFailed();</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>destroyFailedPipelines();</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_spa_pipeline" kindref="compound">SpaPipeline</ref><sp/>*<sp/>findFreePipeline();</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>onPipelineProcessed(<sp/><ref refid="class_spa_pipeline" kindref="compound">SpaPipeline</ref><sp/>*<sp/>pPipeline,</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>HttpRequestBatch<sp/>&amp;<sp/>requeueBatch,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>pipelineSuccess<sp/>);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Orchestrating<sp/>dispatcher.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>Mercury::EventDispatcher<sp/>&amp;<sp/>dispatcher_;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Pool&apos;s<sp/>common<sp/>DNS<sp/>resolver.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>this<sp/>is<sp/>only<sp/>used<sp/>by<sp/>SpaPipeline,<sp/>to<sp/>pass<sp/>through<sp/>to<sp/>HttpPipeline</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_dns_resolver" kindref="compound">DnsResolver</ref><sp/>resolver_;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Period<sp/>in<sp/>seconds<sp/>between<sp/>accumulative<sp/>reports<sp/>of<sp/>failed<sp/>requests.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>FAILURE_REPORT_PERIOD;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Default<sp/>BIAS<sp/>for<sp/>stats.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>BIAS;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Start<sp/>of<sp/>the<sp/>most<sp/>recent<sp/>period<sp/>with<sp/>failures.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64<sp/>failurePeriodStart_;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Accumulated<sp/>number<sp/>of<sp/>failed<sp/>requests<sp/>since<sp/>failurePeriodStart_</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>failurePeriodCount_;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remote<sp/>HTTP<sp/>endpoint.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>BW::string<sp/>hostname_;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16<sp/>port_;</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Pool<sp/>parameters<sp/>(see<sp/>constructor<sp/>comment).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32<sp/>pipelineCount_;</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32<sp/>batchSize_;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32<sp/>queueSize_;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>this<sp/>only<sp/>appears<sp/>to<sp/>be<sp/>used<sp/>by<sp/>SpaPipeline<sp/>to<sp/>pass<sp/>through<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>HttpPipeline</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>int64<sp/>connectionTimeout_;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64<sp/>requestTimeout_;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>BW::vector&lt;<sp/>SpaPipeline<sp/>*<sp/>&gt;<sp/>SpaPipelineList;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>LRU<sp/>list<sp/>of<sp/>pipelines<sp/>ordered<sp/>by<sp/>the<sp/>time<sp/>of<sp/>the<sp/>last<sp/>successfully</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>processed<sp/>batch.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>SpaPipelineList<sp/>lruPipelines_;</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>delayed<sp/>list<sp/>of<sp/>failed<sp/>pipelines<sp/>to<sp/>be<sp/>deleted<sp/>a<sp/>bit<sp/>later.<sp/>Delayed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>deletion<sp/>is<sp/>to<sp/>circumvent<sp/>the<sp/>possible<sp/>problems<sp/>of<sp/>calling<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TcpConnection<sp/>destructor<sp/>while<sp/>in<sp/>Mercury<sp/>timeout<sp/>callback.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>SpaPipelineList<sp/>failedPipelines_;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>queue<sp/>of<sp/>requests<sp/>which<sp/>had<sp/>not<sp/>yet<sp/>found<sp/>its<sp/>way<sp/>into<sp/>a<sp/>pipeline.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Retried<sp/>requests<sp/>from<sp/>failed<sp/>pipelines<sp/>go<sp/>here<sp/>too.<sp/>An<sp/>invariant<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>queue<sp/>is<sp/>sorted<sp/>by<sp/>enqueueTime<sp/>is<sp/>always<sp/>maintained,<sp/>which<sp/>allows</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>time<sp/>out<sp/>old<sp/>requests<sp/>in<sp/>amortized<sp/>O(1)<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>std::deque&lt;<sp/>SpaRequest<sp/>*<sp/>&gt;<sp/>SpaRequestDeque;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/>SpaRequestDeque<sp/>requestQueue_;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Read-write<sp/>lock.<sp/>Used<sp/>to<sp/>prevent<sp/>stack<sp/>overflow<sp/>on<sp/>immediate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>connection<sp/>failure</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>rwLock_;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>isEnabled_;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Stats.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>EMA<sp/>retryCount_;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>EMA<sp/>totalTime_;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>EMA<sp/>timeInQueue_;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>EMA<sp/>spaRequestTime_;</highlight></codeline>
<codeline lineno="147"><highlight class="normal">};</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>defined(<sp/>CODE_INLINE<sp/>)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;spa_request_pool.ipp&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal">BW_END_NAMESPACE</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/>//<sp/>SPA_REQUEST_POOL_HPP</highlight></codeline>
    </programlisting>
    <location file="dbapp_extensions/wgbilling_spa/spa_request_pool.hpp"/>
  </compounddef>
</doxygen>
